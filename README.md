# Three.js Voxel Visualizer

An experimental particle-based voxel renderer, designed to explore optimization strategies for rendering large particle buffers in [Three.js](https://threejs.org/). The model is a 6cm test sphere generated by a volumetric GLSL shader, stored as a sequence of PNGs, or a single "sprite sheet". This voxel shader was used to create larger lamp shades with various Stratasys PolyJet 3d printers. These printers achieve variable-transparency, full color prints by dithering voxels of CMYKW (cyan, magenta, yellow, black, white) and transparent photopolymer resins, along with a sacrificial support material.

## Observations

1. Reading individual pixels from a Canvas Context via `var pixel = ctx.getImageData(x, y, 1, 1).data` is quite slow, even when using a sprite sheet. `willReadFrequently` seems to have little to no effect.
1. `Array.push()` does not seem slower then `Float32Array.set()` for writing data.
1. Bypassing Canvas completely by loading a PNG as a raw file using `XMLHttpRequest`, then piping the arrayBuffer into a `Uint8Array` and decoding via [UPNG](https://github.com/photopea/UPNG.js) seems like the fastest way to read pixel data, and supports indexed color PNG8s as well. 8bit PNGs are more than sufficent for PolyJet voxel printing since PolyJet printers support a maximum of 7-8 colors/resins-types per print.

## TODO

-   [ ] Simulate color blending
-   [ ] Output sprites directly as animated PNG
-   [ ] 3D bounding box calculation

## Installing

1. Clone Repository

```bash
git clone https://github.com/caseprince/voxel-visualizer
```

2. CD into folder

```bash
cd voxel-visualizer
```

3. Install TypeScript

```bash
npm install -g typescript
```

4. Install dependencies

```bash
npm install
```

5. Start it

```bash
npm run dev
```

6. Visit [http://127.0.0.1:8080](http://127.0.0.1:8080)

## Thanks!

-   Three.js TypeScript Boilerplate: [https://github.com/Sean-Bradley/Three.js-TypeScript-Boilerplate.git](https://github.com/Sean-Bradley/Three.js-TypeScript-Boilerplate.git)
-   UPNG.js: [https://github.com/photopea/UPNG.js](https://github.com/photopea/UPNG.js)
-   dat.GUI: [https://github.com/dataarts/dat.gui](https://github.com/dataarts/dat.gui)
